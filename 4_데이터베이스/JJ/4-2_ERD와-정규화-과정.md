# ERD와 정규화 과정

ERD(Entity Relationship Diagram)는 데이터베이스를 구축할 때 가장 기초적인 뼈대 역할을 하며, 릴레이션 간의 관계들을 정의한 것이다. 서비스를 구축한다면 가장 먼저 신경 써야 할 부분이다. 이 부분을 신경 쓰지 않고 서비스를 구축한다면, 단단하지 않은 골조로 건물을 짓는 것이나 다름없다.

## ERD의 중요성

- ERD는 시스템의 요구 사항을 기반으로 작성되며, 이 ERD를 기반으로 데이터베이스를 구축한다.
- 데이터베이스를 구축한 이후에도 디버깅 또는 비즈니스 프로세스 재셜계가 필요한 경우에 설계도 역할을 담당하기도 한다.
- 관계형 구조로 표현할 수 있는 데이터를 구성하는데 유용할 수 있지만, 비정형 데이터를 충분히 표현할 수 없다는 단점이 있다.

비정형 데이터: 비구조화 데이터를 말하며, 미리 정의된 데이터 모델이 없거나 미리 정의된 방식으로 정리되지 않은 정보.

## 예제로 배우는 ERD

ERD의 테이블 필드, 타입은 생략.

### ERD1

요구 사항

- 영업사원은 0~n명의 고객을 관리한다.
- 고객은 0~n개의 주문을 넣을 수 있다.
- 주문에는 1~n개의 상품이 들어간다.

![image](https://github.com/yi-hongju/CS-for-Jobs/assets/44770369/1471bbb6-a6c8-4538-b41b-dfbcf2ae00e7)

### ERD2

요구 사항

- 선수들은 1명의 챔피언을 고를 수 있다.
- 챔피언은 한 개 이상의 스킬을 갖는다.
- 스킬은 한 개 이상의 특성을 갖는다.

![image](https://github.com/yi-hongju/CS-for-Jobs/assets/44770369/05f6e0e8-f81b-4e13-9902-37279ad88073)

## 정규화 과정

- 정규화 과정은 릴레이션 간의 잘못된 종속 관계로 인해 데이터베이스 이상 현상이 일어나서 이를 해결하거나, 저장 공간을 효율적으로 사용하기 위해 릴레이션을 여러 개로 분리하는 과정이다.
- 데이터베이스 이상 현상이란 회원이 한 개의 등급을 가져야 하는데, 세 개의 등급을 갖거나 삭제할 때 필요한 데이터가 같이 삭제되고, 데이터를 삽입해야 하는데 하나의 필드 값이 NULL이 되면 안 되어서 삽입하기 어려운 현상을 말한다.
- 정규화 과정은 정규형 원칙을 기반으로 정규형을 만들어가는 과정이다. 정규화된 정도는 정규형(NF, Normal Form)으로 표현한다. 기본 정규형인 제1정규형, 제2정규형, 제3정규형, 보이스/코드 정규형이 있고 고급 정규형인 제4정규형, 제5정규형이 있다.

### 정규형 원칙

- 정규형의 원칙이란 같은 의미를 표현하는 릴레이션이지만 좀 더 좋은 구조로 만들어야 하고, 자료의 중복성은 감소해야 하고, 독립적인 관계는 별개의 릴레이션으로 표현해야 하며, 각각의 릴레이션은 독립적인 표현이 가능해야 하는 것을 말한다.

### 제1정규형

- 릴레이션의 모든 도메인이 더 이상 분해될 수 없는 원자 값(atomic value)로만 구성되어야 한다.
- 릴레이션의 속성 값 중에서 한 개의 기본키에 대해 두 개 이상의 값을 가지는 반복 집합이 있어서는 안 된다.
- 반복 집합이 있다면 제거해야 한다.

![image](https://github.com/yi-hongju/CS-for-Jobs/assets/44770369/1a011add-ce91-40d3-b5fb-73a1e0a81563)

- 첫 번째 테이블과 같이 구성한 경우, 'DS특강'을 수강신청한 사람을 찾는데 까다로움이 생길 수 있다.
  - WHERE 수강명 = 'DS특강' 사용 불가
  - WHERE 프로그램 LIKE '%DS특강%'과 같이 사용해야 한다. 성능 저하가 있을 수도 있다.
- 수강명 수정에 있어서도 어려움이 있을 수 있다.
- 그래서 제1정규화를 통해 '한 칸엔 하나의 데이터만'

### 제2정규형

- 릴레이션이 제1정규형이며 부분 함수의 종속성을 제거한 형태를 말한다.
- 부분 함수의 종속성 제거란 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속적인 것을 말한다.

![image](https://github.com/yi-hongju/CS-for-Jobs/assets/44770369/46a49742-c8a8-467b-bf4c-7131b0523e2c)

- 기본키인 {유저ID, 수강명}과 완전 종속된 유저본호 릴레이션과 '{유저ID, 수강명}에 따른 성취도' 릴레이션으로 분리된 것을 볼 수 있다.
- 릴레이션을 분해할 때 동등한 릴레이션으로 분해해야 하고, 정보 손실이 발생하지 않는 무손실 분해로 분해되어야 한다는 것이다.

<img width="640" alt="image" src="https://github.com/yi-hongju/CS-for-Jobs/assets/44770369/484de5cc-d3df-4571-b35e-14f0ab60d548">

- 헬스 가격이 7000원으로 변경된다면, 다 수정되어야 한다.
- 데이터가 많을수록 수정하는데 오래 걸릴 것이다.

<img width="640" alt="image" src="https://github.com/yi-hongju/CS-for-Jobs/assets/44770369/1e682936-2737-4f8e-8865-be9bdf5ea638">

<img width="1024" alt="image" src="https://github.com/yi-hongju/CS-for-Jobs/assets/44770369/84db2e53-7f35-4d88-9e13-9a00987af3c5">

- 제2정규화: 현재 테이블의 주제와 관련없는 컬럼을 다른 테이블로 빼는 작업
- 제2정규형: partial dependency를 제거한 테이블

partial dependency: 하나의 composite primary key에 종속

<img width="800" alt="image" src="https://github.com/yi-hongju/CS-for-Jobs/assets/44770369/ef2f7774-f076-4e3b-9ac4-d2defafd639f">

### 제3정규형

- 제2정규형이고 기본키가 아닌 모든 속성이 이행적 함수 종속(transitive FD)를 만족하지 않는 상태를 말한다.

이행적 함수 종속

- 이행적 함수 종속이란 A -> B와 B -> C가 존재하면 논리적으로 A -> C가 성립하는데, 이 때 집합 C가 집합 A에 이행적으로 함수 종속이 되었다고 한다.

![image](https://github.com/yi-hongju/CS-for-Jobs/assets/44770369/c48a976a-87e7-46a0-9ed6-c32e7c5431c4)

![image](https://github.com/yi-hongju/CS-for-Jobs/assets/44770369/11d8a84a-0334-4984-ac67-8b1531f30e2f)

<img width="1024" alt="image" src="https://github.com/yi-hongju/CS-for-Jobs/assets/44770369/1e1a16ae-a69d-4fcc-bc90-03f3e9e2e1d1">

- '출신대학' 컬럼은 프라이머리 키인 '프로그램'과 전혀 상관 없다. '강사' 컬럼에만 종속.
- 제3정규화: 일반 컬럼에만 종속된 컬럼은 다른 테이블로 빼기

<img width="1024" alt="image" src="https://github.com/yi-hongju/CS-for-Jobs/assets/44770369/67099bcf-96a1-41b1-8d43-23139ee1c264">

[코딩애플 - 데이터 정규화가 뭔지 설명해보세요 (개발면접타임)](https://www.youtube.com/watch?v=Y1FbowQRcmI)

### 보이스/코드 정규형

- 보이스/코드 정규형(BCNF)은 제3정규형이고, 결정자가 후보키가 아닌 함수 종속 관계를 제거하여 릴레이션의 함수 종속 관계에서 모든 결정자가 후보키인 상태를 말한다.

결정자: 함수 종속 관계에서 특정 종속자(dependent)를 결정짓는 요소. 'X -> Y'일 때 X는 결정자, Y는 종속자.
